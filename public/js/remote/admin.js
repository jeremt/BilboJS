// Generated by CoffeeScript 1.3.3
var Dashboard, closeBtn, dashboard, evt, getKey, grid, optionBtn, options, remote, toOption, toRemote,
  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

Dashboard = (function() {
  var _digits, _display, _max, _slide, _time, _timeSlide;

  _slide = 1;

  _max = null;

  _time = 0;

  _timeSlide = 0;

  function Dashboard() {
    _max = $('#remote > hgroup > h3').text().split('/')[1];
    console.log(_max);
  }

  _digits = function(num) {
    if (num < 10) {
      return '0' + num;
    } else {
      return num;
    }
  };

  _display = function(num) {
    var m, s;
    m = ~~(num / 60);
    s = ~~(num % 60);
    return _digits(m + ':' + _digits(s));
  };

  Dashboard.prototype.prev = function() {
    _timeSlide = 0;
    _slide--;
    if (_slide < 1) {
      return _slide = _max;
    }
  };

  Dashboard.prototype.next = function() {
    _timeSlide = 0;
    _slide++;
    if (_slide > _max) {
      return _slide = 1;
    }
  };

  Dashboard.prototype.step = function() {
    _time++;
    _timeSlide++;
    $('#remote > hgroup > h1').text(_display(_time));
    $('#remote > hgroup > h2').text(_display(_timeSlide));
    return $('#remote > hgroup > h3').text(_slide + '/' + _max);
  };

  Dashboard.prototype.run = function() {
    return setInterval(this.step, 1000);
  };

  return Dashboard;

})();

dashboard = new Dashboard;

dashboard.run();

getKey = function() {
  var key;
  key = $(this).html();
  switch (key) {
    case '→':
    case '↓':
      dashboard.next();
      break;
    case '←':
    case '↑':
      dashboard.prev();
  }
  if (key && key !== ' ') {
    return now.getKey(key);
  }
};

evt = __indexOf.call(document, 'touchstart') >= 0 ? 'tap' : 'click';

$('#key-map > button').on(evt, getKey);

grid = function() {
  var btnHeight, btnWidth, winHeight, winWidth;
  winWidth = document.body.clientWidth;
  winHeight = window.innerHeight;
  btnWidth = winWidth / 3 - 6;
  btnHeight = (winHeight - 100) / 3 - 6;
  $('body').css('overflow', 'hidden');
  $('.remote-page').css({
    width: winWidth,
    height: winHeight
  });
  $('#key-map').css({
    position: 'absolute',
    bottom: 0,
    width: winWidth,
    height: winHeight - 100
  });
  $('#key-map > button').css({
    width: btnWidth,
    height: btnHeight,
    margin: 2
  });
  return $('#key-map > button:last-child').css({
    margin: 0
  });
};

$(grid);

$('body').on('change', grid);

$(window).on('resize', grid);

options = $('#options');

remote = $('#remote');

optionBtn = $('#option-btn');

closeBtn = $('#close-btn');

toRemote = function() {
  options.removeClass('visible').addClass('hidden');
  remote.removeClass('hidden').addClass('visible');
  optionBtn.show();
  return closeBtn.hide();
};

toOption = function() {
  options.removeClass('hidden').addClass('visible');
  remote.removeClass('visible').addClass('hidden');
  closeBtn.show();
  return optionBtn.hide();
};

optionBtn.click(toOption);

closeBtn.click(toRemote);

$('#save > button').click(toRemote);
